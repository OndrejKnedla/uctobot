EXPENSE_CATEGORIES = {
    "501100": {
        "name": "Spotřeba materiálu",
        "keywords": ["materiál", "papír", "toner", "kancelářské potřeby", "psací potřeby", "složky", "šanony", "sešity", "bloky"],
        "description": "Kancelářský materiál a spotřební materiál"
    },
    "501300": {
        "name": "PHM",
        "keywords": ["benzín", "nafta", "palivo", "tankování", "čerpací stanice", "natural", "lpg", "cng", "phm"],
        "description": "Pohonné hmoty do vozidel"
    },
    "501400": {
        "name": "Drobný majetek",
        "keywords": ["notebook", "počítač", "monitor", "klávesnice", "myš", "telefon", "tablet", "tiskárna", "router", "nábytek", "židle", "stůl"],
        "description": "Majetek do 80 000 Kč"
    },
    "512100": {
        "name": "Cestovné",
        "keywords": ["vlak", "autobus", "letenka", "taxi", "uber", "bolt", "mhd", "jízdenka", "lítačka", "doprava", "cestovné"],
        "description": "Náklady na dopravu a cestování"
    },
    "513100": {
        "name": "Reprezentace",
        "keywords": ["oběd", "večeře", "klient", "káva", "restaurace", "občerstvení", "meeting", "schůzka", "jednání", "reprezentace"],
        "description": "Občerstvení při jednání s klienty (50% daňově uznatelné)"
    },
    "518100": {
        "name": "Nájemné",
        "keywords": ["nájem", "kancelář", "pronájem", "prostor", "místnost", "sklad", "garáž", "pacht"],
        "description": "Nájemné za kancelář nebo jiné prostory"
    },
    "518200": {
        "name": "Telefon a internet",
        "keywords": ["telefon", "internet", "mobil", "data", "tarif", "vodafone", "o2", "t-mobile", "paušál", "volání", "sim"],
        "description": "Telekomunikační služby"
    },
    "518300": {
        "name": "Software",
        "keywords": ["software", "aplikace", "předplatné", "licence", "adobe", "microsoft", "google", "cloud", "hosting", "doména", "office", "creative cloud"],
        "description": "Software a cloudové služby"
    },
    "518400": {
        "name": "Poštovné",
        "keywords": ["pošta", "známky", "balík", "doporučeně", "kurýr", "zásilka", "dpd", "ppl", "zásilkovna", "balíkovna"],
        "description": "Poštovní a kurýrní služby"
    },
    "518500": {
        "name": "Právní a poradenské služby",
        "keywords": ["právník", "advokát", "účetní", "daňový poradce", "konzultace", "audit", "notář", "poradenství"],
        "description": "Externí odborné služby"
    },
    "518600": {
        "name": "Marketing a reklama",
        "keywords": ["reklama", "inzerce", "facebook", "google ads", "marketing", "propagace", "letáky", "vizitky", "billboard", "ppc"],
        "description": "Propagace a marketing"
    },
    "518700": {
        "name": "Školení a vzdělávání",
        "keywords": ["školení", "kurz", "seminář", "konference", "workshop", "vzdělávání", "certifikace", "zkouška"],
        "description": "Profesní vzdělávání a rozvoj"
    },
    "518900": {
        "name": "Ostatní služby",
        "keywords": ["služba", "servis", "oprava", "údržba", "úklid", "mytí", "revize", "kontrola"],
        "description": "Různé ostatní služby"
    },
    "521100": {
        "name": "Mzdy",
        "keywords": ["mzda", "plat", "odměna", "výplata", "hrubá mzda", "čistá mzda"],
        "description": "Mzdové náklady"
    },
    "524100": {
        "name": "Zákonné sociální pojištění",
        "keywords": ["sociální pojištění", "zdravotní pojištění", "pojistné", "odvody", "sp", "zp"],
        "description": "Povinné pojistné"
    },
    "538100": {
        "name": "Ostatní daně a poplatky",
        "keywords": ["daň", "poplatek", "správní poplatek", "kolky", "dálniční známka", "silniční daň"],
        "description": "Různé daně a poplatky"
    },
    "543100": {
        "name": "Dary",
        "keywords": ["dar", "sponzoring", "charita", "nadace", "příspěvek"],
        "description": "Dary a sponzorské příspěvky"
    },
    "545100": {
        "name": "Pokuty a penále",
        "keywords": ["pokuta", "penále", "úrok z prodlení", "sankce"],
        "description": "Pokuty a penále (daňově neuznatelné)"
    },
    "549100": {
        "name": "Ostatní provozní náklady",
        "keywords": ["ostatní", "jiné", "různé", "provozní"],
        "description": "Nezařazené provozní náklady"
    },
    "562100": {
        "name": "Úroky z úvěrů",
        "keywords": ["úrok", "úvěr", "půjčka", "leasing", "splátka úroků"],
        "description": "Úroky z úvěrů a půjček"
    },
    "568100": {
        "name": "Bankovní poplatky",
        "keywords": ["bankovní poplatek", "vedení účtu", "převod", "transakce", "výpis", "karta"],
        "description": "Poplatky bance"
    }
}

INCOME_CATEGORIES = {
    "602100": {
        "name": "Tržby za služby",
        "keywords": ["faktura", "služba", "práce", "konzultace", "projekt", "zakázka", "honorář", "odměna za práci"],
        "description": "Příjmy z poskytnutých služeb"
    },
    "602200": {
        "name": "Tržby za poradenství",
        "keywords": ["poradenství", "konzultace", "školení", "workshop", "mentoring", "koučink"],
        "description": "Příjmy z poradenské činnosti"
    },
    "602300": {
        "name": "Tržby za IT služby",
        "keywords": ["programování", "vývoj", "web", "aplikace", "it služby", "správa systémů"],
        "description": "Příjmy z IT služeb"
    },
    "604100": {
        "name": "Tržby za zboží",
        "keywords": ["prodej", "zboží", "produkt", "výrobek", "tovar"],
        "description": "Příjmy z prodeje zboží"
    },
    "641100": {
        "name": "Tržby z prodeje majetku",
        "keywords": ["prodej majetku", "prodej auta", "prodej vybavení", "odprodej"],
        "description": "Příjmy z prodeje dlouhodobého majetku"
    },
    "644100": {
        "name": "Smluvní pokuty a penále",
        "keywords": ["pokuta přijatá", "penále přijaté", "úrok z prodlení přijatý", "sankce přijatá"],
        "description": "Přijaté pokuty a penále"
    },
    "648100": {
        "name": "Ostatní provozní výnosy",
        "keywords": ["ostatní", "jiné", "různé", "provozní výnos", "náhrada", "pojistné plnění"],
        "description": "Nezařazené provozní výnosy"
    },
    "662100": {
        "name": "Úroky z účtů",
        "keywords": ["úrok", "úrok z účtu", "výnos z termínovaného vkladu"],
        "description": "Úroky z bankovních účtů"
    },
    "663100": {
        "name": "Kurzové zisky",
        "keywords": ["kurzový zisk", "kurzový rozdíl", "přepočet měny"],
        "description": "Zisky z kurzových rozdílů"
    }
}

def get_all_categories():
    return {
        "expenses": EXPENSE_CATEGORIES,
        "income": INCOME_CATEGORIES
    }

def get_category_by_code(code: str):
    if code in EXPENSE_CATEGORIES:
        return EXPENSE_CATEGORIES[code]
    elif code in INCOME_CATEGORIES:
        return INCOME_CATEGORIES[code]
    return None

def get_category_name(code: str) -> str:
    category = get_category_by_code(code)
    return category['name'] if category else "Nezařazeno"

def find_best_category(text: str, transaction_type: str) -> tuple[str, str]:
    text_lower = text.lower()
    categories = EXPENSE_CATEGORIES if transaction_type == 'expense' else INCOME_CATEGORIES
    
    best_category = None
    best_score = 0
    
    for code, info in categories.items():
        score = 0
        for keyword in info['keywords']:
            if keyword.lower() in text_lower:
                score += len(keyword)
        
        if score > best_score:
            best_score = score
            best_category = code
    
    if not best_category:
        best_category = "549100" if transaction_type == 'expense' else "648100"
    
    return best_category, categories[best_category]['name']